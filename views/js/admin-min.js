function make_chosen_autocomplete(e,t,n=!1){$("div#"+e+"_chosen .search-field input").keyup(delay(function(){$.ajax({url:t+"&q="+$(this).val(),dataType:"json",success:function(t){var o;t&&$("#"+e+"_chosen .no-results").html('No results match "'+$("#"+e+"_chosen .chosen-choices input").val()+'"'),$.each(t,function(t,a){if($("#"+e+" option").each(function(){this.value==a.value&&(o=!0)}),!o){n?$("#"+e).append("<option value="+a.value+">"+a.caption+" id:"+a.value+"</option>"):$("#"+e).append("<option value="+a.value+">"+a.caption+"</option>");var s=$("#"+e+" .chosen-choices input").val();$("#"+e).trigger("chosen:updated"),$("#"+e+" .chosen-choices input").val(s)}})}})},1e3,e))}function navigateToUrl(e){document.location=document.location.href+"&"+e}function delay(e,t,n){var o=0;return function(){$("#"+n+"_chosen .no-results").html('Getting Data "'+$("#"+n+"_chosen .chosen-choices input").val()+'"');var a=this,s=arguments;clearTimeout(o),o=setTimeout(function(){e.apply(a,s)},t||0)}}function pie_chart_news(e,t){nv.addGraph(function(){var e=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).color(d3.scale.category10().range()).donut(!0).showLabels(!1).showLegend(!1);return d3.select("#dash_traffic_chart2 svg").datum(t.data).transition().duration(1200).call(e),nv.utils.windowResize(e.update),e})}$(function(){nv.addGraph(function(){var e=nv.models.lineChart().margin({left:100}).useInteractiveGuideline(!0).transitionDuration(350).showLegend(!0).showYAxis(!0).showXAxis(!0);e.xAxis.axisLabel("Date").tickFormat(function(e){return d3.time.format("%x")(new Date(1e3*e))}),e.yAxis.axisLabel("Amount").tickFormat(d3.format(".02f"));var t=function(){for(var e=[],t=[],n=[],o=[],a=0;a<stats.length;a++)e.push({x:stats[a].date_sent,y:stats[a].sent_number}),t.push({x:stats[a].date_sent,y:stats[a].open}),n.push({x:stats[a].date_sent,y:stats[a].click}),o.push({x:stats[a].date_sent,y:stats[a].failed});stats.length||(e.push({x:0,y:0}),t.push({x:0,y:0}),n.push({x:0,y:0}),o.push({x:0,y:0}));return[{values:e,key:"Send",color:"#ff7f0e"},{values:t,key:"Open",color:"#2ca02c"},{values:n,key:"Click",color:"#7777ff"},{values:o,key:"Failed",color:"#7777ff"}]}();return d3.select("#chart svg").attr("preserveAspectRatio","xMinYMin meet").attr("viewBox","0 0 720 340").datum(t).call(e),nv.utils.windowResize(function(){e.update()}),e}),$(".timepicker").datetimepicker({prevText:"",nextText:"",dateFormat:"yy-mm-dd",currentText:"Now",closeText:"Done",ampm:!1,amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"hh:mm:ss tt",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute"});let e=$("#target_customer").val();function t(e,t,n){parseInt(n)===t?e.closest(".form-group").slideDown():e.closest(".form-group").slideUp()}e&&(t($("#groups"),7,e),t($("#ab_day"),5,e),t($("#newsletter_autocomplete_input"),"cart",$("#target_news").val()),$("#dstemplate_form #description").closest(".form-group").hide(),make_chosen_autocomplete("newsletter_autocomplete_input",urlJson+"&action=getNews"),make_chosen_autocomplete("product_autocomplete_input",urlJson+"&action=getProduct",!0)),$("#select_newsletter").on("change",function(e){navigateToUrl(this.value)});let n=$("#target_customer");n.on("change",function(e){var n=$(this).val();t($("#groups"),7,n),t($("#ab_day"),5,n)});let o=$("#target_news");o.on("change",function(){t($("#newsletter_autocomplete_input"),4,this.value)}),o.length&&(o.change(),n.change()),$(document.body).on("click","a.sent",function(e){e.preventDefault();var t=function(){$.ajax({type:"GET",url:urlJson+"&ajax=1&action=getProgress",success:function(e){var n=parseInt(e);console.log(n),n<100||-1===n?(-1===n&&(e="estimating..."),$("#overlay").show(),$("#progress").html(e),setTimeout(t,1e3)):(clearInterval(t),$("#overlay").hide())}})};setTimeout(t,1e3),$("a.sent").fancybox({type:"ajax",onCleanup:function(){window.location.reload(!0)},afterClose:function(){window.location.reload(!0)}})}),$(".statistics td").removeAttr("onclick")});